/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
var key = 'pk_live_kzUEyLVE1foloFBIpZpi6pZh';
var urlParams = new URLSearchParams(window.location.search);
var redirect_url = ps_site_url + '/stripe_ideal_redirect_url/';
var clientSecret = '';
function reset_payment_form() {

    jQuery('.day_ticket_details').addClass('hidden');
    jQuery('.cart-details').hide();

    jQuery('.day_ticket_vehicle_details').addClass('hidden');
    jQuery('.day_ticket_vehicle_details_form').removeClass('hidden');
    jQuery('.day_ticket_vehicle_details_form').find('.booking_email').val('');
    jQuery('.day_ticket_vehicle_details_form').find('.date_allowed').val('');
    jQuery('.day_ticket_vehicle_details_form').find('.vehicle_num').val('');
    jQuery('.day_ticket_vehicle_details_form_confirm').addClass('hidden');
    jQuery('.day_ticket_vehicle_details_payment_form').addClass('hidden');
    jQuery('.day_ticket_vehicle_details_payment_form_ideal').addClass('hidden');
    jQuery('.day_ticket_vehicle_details_payment_form_card').addClass('hidden');


    jQuery('.day_ticket_person_details').addClass('hidden');
    jQuery('.day_ticket_person_details_form').removeClass('hidden');
//    jQuery('.day_ticket_person_details_form').find('.amount').val('');
//    jQuery('.day_ticket_person_details_form').find('.amount_formated').val('');
    jQuery('.day_ticket_person_details_form').find('.booking_date').val('');
    jQuery('.day_ticket_person_details_form').find('.booking_dob').val('');
    jQuery('.day_ticket_person_details_form').find('.booking_email').val('');
    jQuery('.day_ticket_person_details_form_confirm').addClass('hidden');
    jQuery('.day_ticket_person_details_payment_form').addClass('hidden');
    jQuery('.day_ticket_person_details_payment_form_ideal').addClass('hidden');
    jQuery('.day_ticket_person_details_payment_form_card').addClass('hidden');


    jQuery('.hourly_ticket_details').addClass('hidden');
    jQuery('.hourly_ticket_details_form').removeClass('hidden');
    jQuery('.day_ticket_person_details_form').find('.vehicle_num').val('');
    jQuery('.hourly_ticket_details_form_confirm').addClass('hidden');
    jQuery('.hourly_ticket_details_payment_form').addClass('hidden');
    jQuery('.hourly_ticket_payment_form_ideal').addClass('hidden');
    jQuery('.hourly_ticket_payment_form_card').addClass('hidden');

    jQuery('.yearly_ticket_details').addClass('hidden');

    jQuery('.yearly_ticket_vehicle_details').addClass('hidden');
    jQuery('.yearly_ticket_vehicle_details_form').removeClass('hidden');
//    jQuery('.yearly_ticket_vehicle_details_form').find('.amount').val('');
//    jQuery('.yearly_ticket_vehicle_details_form').find('.amount_formated').val('');
    jQuery('.yearly_ticket_vehicle_details_form').find('.booking_user_name').val('');
    jQuery('.yearly_ticket_vehicle_details_form').find('.booking_email').val('');
    jQuery('.yearly_ticket_vehicle_details_form').find('.vehicle_num').val('');
    jQuery('.yearly_ticket_vehicle_details_form_confirm').addClass('hidden');
    jQuery('.yearly_ticket_vehicle_details_payment_form').addClass('hidden');
    jQuery('.yearly_ticket_vehicle_details_payment_form_ideal').addClass('hidden');
    jQuery('.yearly_ticket_vehicle_details_payment_form_card').addClass('hidden');

    jQuery('.yearly_ticket_person_details').addClass('hidden');
    jQuery('.yearly_ticket_person_details_form').removeClass('hidden');
//    jQuery('.yearly_ticket_person_details_form').find('.amount').val('');
//    jQuery('.yearly_ticket_person_details_form').find('.amount_formated').val('');
    jQuery('.yearly_ticket_person_details_form').find('.booking_user_name').val('');
    jQuery('.yearly_ticket_person_details_form').find('.booking_user_name').removeClass('required-missing');
    jQuery('.yearly_ticket_person_details_form').find('.booking_email').val('');
    jQuery('.yearly_ticket_person_details_form').find('.booking_email').removeClass('required-missing');
    jQuery('.yearly_ticket_person_details_form').find('.booking_dob').val('');
    jQuery('.yearly_ticket_person_details_form').find('.booking_dob').removeClass('required-missing');
    jQuery('.yearly_ticket_person_details_form_confirm').addClass('hidden');
    jQuery('.yearly_ticket_person_details_payment_form').addClass('hidden');
    jQuery('.yearly_ticket_person_details_payment_form_ideal').addClass('hidden');
    jQuery('.yearly_ticket_person_details_payment_form_card').addClass('hidden');
    jQuery('.checkout_form').addClass('hidden');
    jQuery('.payment_form_ideal').addClass('hidden');
    jQuery('.payment_form_card').addClass('hidden');
    jQuery('.step1').removeClass('hidden');
    jQuery('.cart-details').hide();
    jQuery('.header-section').removeClass('invisible');
    jQuery('.date_allowed').datetimepicker({
        format: 'DD/MM/YYYY',
        date: new Date(),
        minDate: new Date(),
    });
}
function checkout_page() {
    var fd = new FormData();
    fd.append('action', 'get_checkout_html');
    jQuery.ajax({
        type: 'POST',
        url: ajaxurl,
        data: fd,
        contentType: false,
        processData: false,
        dataType: 'json',
        complete: function (data) {
            jQuery('.checkout_form_content').html(data.responseJSON.html);
            jQuery('.cart-details').html(data.responseJSON.cart_html);
            jQuery('.items_count_con').html(data.responseJSON.cart_count);
            reset_payment_form();
            jQuery('.btn-checkout-popup').click(function () {
                checkout_page();
            });
            jQuery('.remove_cart_item').click(function () {
                var key_item = jQuery(this).attr('data-key');
                remove_cart_item(key_item);
            });
            jQuery('.step1').addClass('hidden');
            jQuery('.checkout_form').removeClass('hidden');
            jQuery('.header-section').addClass('invisible');
        }

    });
}
function remove_cart_item(key) {
    var fd = new FormData();
    fd.append('key_value', key);
    fd.append('action', 'remove_cart_item');
    jQuery.ajax({
        type: 'POST',
        url: ajaxurl,
        data: fd,
        contentType: false,
        processData: false,
        dataType: 'json',
        complete: function (data) {
            jQuery('.checkout_form_content').html(data.responseJSON.html);
            jQuery('.cart-details').html(data.responseJSON.cart_html);
            jQuery('.items_count_con').html(data.responseJSON.cart_count);
            if (data.responseJSON.cart_count == 0) {
                reset_payment_form();
            }
            jQuery('.btn-checkout-popup').click(function () {
                checkout_page();
            });
            jQuery('.remove_cart_item').click(function () {
                var key_item = jQuery(this).attr('data-key');
                remove_cart_item(key_item);
            });
        }

    });
}
jQuery(document).ready(function () {
    jQuery('.submit_btn_ideal').click(function () {
        if (jQuery(this).hasClass('clicked_element')) {
            return false;
        }
        jQuery(this).addClass('clicked_element');
    });
    jQuery(".fa-shopping-cart,  .items_count_con").click(function () {
        if (jQuery(this).parent().find(".cart-details").is(":visible")) {
            jQuery(this).parent().find(".cart-details").slideUp("slow");
        } else {
            jQuery(this).parent().find(".cart-details").slideDown("slow");
        }
    });
//    jQuery(".fa-shopping-cart").mouseenter(function () {
//        jQuery(this).parent().find(".cart-details").slideDown("slow");
//    });
//    jQuery(".header-section").mouseleave(function () {
//        jQuery(this).parent().find(".cart-details").slideUp("slow");
//    });
    var date = new Date();
    date.setDate(date.getDate() - 1);
    jQuery('.date_allowed').datetimepicker({
        format: 'DD/MM/YYYY',
//        date: new Date(),
//        minDate: new Date(),
        minDate: date
    });
    jQuery('.booking_dob').datetimepicker({
        format: 'DD/MM/YYYY',
        viewMode: 'years',
        maxDate: moment().subtract(03, 'years')
    });
    jQuery('.step_back').click(function () {
        reset_payment_form();
        return false;
    });
    jQuery('.btn-alert-no').click(function () {
        jQuery('.day_ticket_vehicle_details_form_alert').addClass('hidden');
        return false;
    });
    jQuery('.btn-alert-yes').click(function () {
        jQuery('.day_ticket_vehicle_details_form_alert').addClass('hidden');
        jQuery('.day_ticket_vehicle_details_form').addClass('hidden');
        jQuery('.day_ticket_vehicle_details_form_confirm').removeClass('hidden');
        return false;
    });
    jQuery('.btn-checkout-popup').click(function () {
        checkout_page();
    });
    jQuery('.remove_cart_item').click(function () {
        var key_item = jQuery(this).attr('data-key');
        remove_cart_item(key_item);
    });

//    Day Ticket Handling
    jQuery('.day_ticket').click(function () {
        jQuery('.step1').addClass('hidden');
        jQuery('.day_ticket_details').removeClass('hidden');
    });

//    Day Ticket Vehicle Handling
    jQuery('.day_ticket_vehicle').click(function () {
        if (jQuery(this).hasClass('sold-out')) {
            return;
        }
        jQuery('.step1').addClass('hidden');
        jQuery('.cart-details').hide();
        jQuery('.day_ticket_details').addClass('hidden');
        jQuery('.day_ticket_vehicle_details').removeClass('hidden');
    });
    jQuery('.day_ticket_vehicle_details_form_submit').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.cart-details').hide();
        var product_id = jQuery('.day_ticket_vehicle_details_form .product_id').val();
        var product_name = jQuery('.day_ticket_vehicle_details_form .product_name').val();
        var vehicle_num = jQuery('.day_ticket_vehicle_details_form .vehicle_num').val();
        var booking_date = jQuery('.day_ticket_vehicle_details_form .booking_date').val();
        var booking_email = jQuery('.day_ticket_vehicle_details_form .booking_email').val();
        var error = 0;
        if (vehicle_num === '') {
            error = 1;
            jQuery('.day_ticket_vehicle_details_form .vehicle_num').addClass('required-missing');
        } else {
            jQuery('.day_ticket_vehicle_details_form .vehicle_num').removeClass('required-missing');
        }
        if (booking_date === '') {
            error = 1;
            jQuery('.day_ticket_vehicle_details_form .booking_date').addClass('required-missing');
        } else {
            jQuery('.day_ticket_vehicle_details_form .booking_date').removeClass('required-missing');
        }
        if (error === 1) {
            var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Alle velden gemarkeerd met (*) zijn verplicht.</div>';
            jQuery('.alert_message').html(error_html);
            jQuery('.overlay').addClass('hidden');
            return false;
        }
        var fd = new FormData();
        fd.append("vehicle_num", vehicle_num);
        fd.append("booking_date", booking_date);
        fd.append('action', 'get_vehicle_price_day');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {

                    jQuery('.day_ticket_vehicle_details_form_confirm .label_amount').html('&euro;' + data.responseJSON.display_amount);
                    jQuery('.day_ticket_vehicle_details_form_confirm .label_vehicle').html(vehicle_num);
                    jQuery('.day_ticket_vehicle_details_form_confirm .label_booking_date').html(booking_date);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_amount').val(data.responseJSON.amount);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_vehicle').val(vehicle_num);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking_date').val(booking_date);
                    jQuery('.day_ticket_vehicle_details_form_confirm .label_booking_email').html(booking_email);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking_email').val(booking_email);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking').val(data.responseJSON.booking);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_existing_booking').val(data.responseJSON.existing_booking);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_product_id').val(product_id);
                    jQuery('.day_ticket_vehicle_details_form_confirm .hidden_product_name').val(product_name);
                    if (data.responseJSON.is_alert === 1) {
                        jQuery('.day_ticket_vehicle_details_form_alert').removeClass('hidden');
                    } else {
                        jQuery('.day_ticket_vehicle_details_form').addClass('hidden');
                        jQuery('.day_ticket_vehicle_details_form_confirm').removeClass('hidden');
                    }

                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + data.responseJSON.message + '</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }
        });
    });
    jQuery('.add_to_cart_day_ticket_vehicle').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.cart-details').hide();
        var product_id = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_product_id').val();
        var product_name = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_product_name').val();
        var vehicle_num = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_vehicle').val();
        var booking_id = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking').val();
        var booking_date = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking_date').val();
        var booking_email = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking_email').val();
        var amount = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_amount').val();

        var fd = new FormData();
        fd.append("type", 1);
        fd.append("product_id", product_id);
        fd.append("product_name", 'day_vehicle_ticket');
        fd.append("vehicle_num", vehicle_num);
        fd.append("booking_date", booking_date);
        fd.append("booking_id", booking_id);
        fd.append("booking_email", booking_email);
        fd.append("amount", amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });

                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });
    jQuery('.day_ticket_vehicle_details_confirm').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.cart-details').hide();
        var product_id = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_product_id').val();
        var product_name = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_product_name').val();
        var vehicle_num = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_vehicle').val();
        var booking_id = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking').val();
        var booking_date = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking_date').val();
        var booking_email = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_booking_email').val();
        var amount = jQuery('.day_ticket_vehicle_details_form_confirm .hidden_amount').val();

        var fd = new FormData();
        fd.append("type", 1);
        fd.append("product_id", product_id);
        fd.append("product_name", 'day_vehicle_ticket');
        fd.append("vehicle_num", vehicle_num);
        fd.append("booking_date", booking_date);
        fd.append("booking_id", booking_id);
        fd.append("booking_email", booking_email);
        fd.append("amount", amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.checkout_form_content').html(data.responseJSON.checkout_html);
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    jQuery('.remove_cart_item').click(function () {
                        var key_item = jQuery(this).attr('data-key');
                        remove_cart_item(key_item);
                    });
                    jQuery('.step1').addClass('hidden');
                    jQuery('.checkout_form').removeClass('hidden');
                    jQuery('.header-section').addClass('invisible');
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });

//    Day Ticket Person Handling
    jQuery('.day_ticket_person').click(function () {
        if (jQuery(this).hasClass("sold-out")) {
            return;
        }
        jQuery('.step1').addClass('hidden');
        jQuery('.cart-details').hide();
        jQuery('.day_ticket_details').addClass('hidden');
        jQuery('.day_ticket_person_details').removeClass('hidden');
    });
    jQuery('.day_ticket_person_details_form_submit').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.cart-details').hide();
        var amount_formated = jQuery('.day_ticket_person_details_form .amount_formated').val();
        var product_id = jQuery('.day_ticket_person_details_form .product_id').val();
        var product_name = jQuery('.day_ticket_person_details_form .product_name').val();
        var amount = jQuery('.day_ticket_person_details_form .amount').val();
        var booking_quantity = jQuery('.day_ticket_person_details_form .booking_quantity').val();
        var available_tickets = jQuery('#total_person_available').val();
//        if (booking_quantity > available_tickets) {
//            var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>U kunt maximaal ' + available_tickets + ' tickets kopen.</div>';
//            jQuery('.alert_message').html(error_html);
//            jQuery('.overlay').addClass('hidden');
//            return false;
//        }
        var booking_date = jQuery('.day_ticket_person_details_form .booking_date').val();
        var booking_email = jQuery('.day_ticket_person_details_form .booking_email').val();
        var error = 0;
        if (booking_email === '') {
            error = 1;
            jQuery('.day_ticket_person_details_form .booking_email').addClass('required-missing');
        } else {
            jQuery('.day_ticket_person_details_form .booking_email').removeClass('required-missing');
        }
        if (booking_date === '') {
            error = 1;
            jQuery('.day_ticket_person_details_form .booking_date').addClass('required-missing');
        } else {
            jQuery('.day_ticket_person_details_form .booking_date').removeClass('required-missing');
        }
        if (error === 1) {
            var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Alle velden gemarkeerd met (*) zijn verplicht.</div>';
            jQuery('.alert_message').html(error_html);
            jQuery('.overlay').addClass('hidden');
            return false;
        }
        var fd = new FormData();
        fd.append("type_query", 'person');
        fd.append("booking_date", booking_date);
        fd.append("quantity", booking_quantity);
        fd.append('action', 'get_tickets_availability_future_date');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.day_ticket_person_details_form_confirm .label_amount').html(amount_formated);
                    jQuery('.day_ticket_person_details_form_confirm .label_booking_email').html(booking_email);
                    jQuery('.day_ticket_person_details_form_confirm .label_booking_date').html(booking_date);
                    jQuery('.day_ticket_person_details_form_confirm .label_booking_quantity').html(booking_quantity);
                    jQuery('.day_ticket_person_details_form_confirm .hidden_amount').val(amount);
                    jQuery('.day_ticket_person_details_form_confirm .hidden_booking_quantity').val(booking_quantity);
                    jQuery('.day_ticket_person_details_form_confirm .hidden_booking_date').val(booking_date);
                    jQuery('.day_ticket_person_details_form_confirm .hidden_booking_email').val(booking_email);
                    jQuery('.day_ticket_person_details_form_confirm .hidden_product_id').val(product_id);
                    jQuery('.day_ticket_person_details_form_confirm .hidden_product_name').val(product_name);
                    jQuery('.day_ticket_person_details_form').addClass('hidden');
                    jQuery('.day_ticket_person_details_form_confirm').removeClass('hidden');
                } else {
                    jQuery('.day_ticket_person_details_form .booking_date').addClass('required-missing');
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + data.responseJSON.message + '.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }
        });
    });
    jQuery('.add_to_cart_day_ticket_person').click(function () {

        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.day_ticket_person_details_form_confirm .hidden_amount').val();
        var hidden_booking_quantity = jQuery('.day_ticket_person_details_form_confirm .hidden_booking_quantity').val();
        var hidden_booking_date = jQuery('.day_ticket_person_details_form_confirm .hidden_booking_date').val();
        var hidden_product_id = jQuery('.day_ticket_person_details_form_confirm .hidden_product_id').val();
        var hidden_product_name = jQuery('.day_ticket_person_details_form_confirm .hidden_product_name').val();
        var hidden_booking_email = jQuery('.day_ticket_person_details_form_confirm .hidden_booking_email').val();

        var fd = new FormData();
        fd.append("type", 1);
        fd.append("product_id", hidden_product_id);
        fd.append("product_name", 'day_person_ticket');
        fd.append("booking_date", hidden_booking_date);
        fd.append("hidden_booking_quantity", hidden_booking_quantity);
        fd.append("dob", '0');
        fd.append("booking_email", hidden_booking_email);
        fd.append("amount", hidden_amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + data.responseJSON.message + '.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });
    jQuery('.day_ticket_person_details_confirm').click(function () {
        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.day_ticket_person_details_form_confirm .hidden_amount').val();
        var hidden_booking_quantity = jQuery('.day_ticket_person_details_form_confirm .hidden_booking_quantity').val();
        var hidden_booking_date = jQuery('.day_ticket_person_details_form_confirm .hidden_booking_date').val();
        var hidden_product_id = jQuery('.day_ticket_person_details_form_confirm .hidden_product_id').val();
        var hidden_product_name = jQuery('.day_ticket_person_details_form_confirm .hidden_product_name').val();
        var hidden_booking_email = jQuery('.day_ticket_person_details_form_confirm .hidden_booking_email').val();

        var fd = new FormData();
        fd.append("type", 1);
        fd.append("product_id", hidden_product_id);
        fd.append("product_name", 'day_person_ticket');
        fd.append("booking_date", hidden_booking_date);
        fd.append("dob", '0');
        fd.append("booking_email", hidden_booking_email);
        fd.append("hidden_booking_quantity", hidden_booking_quantity);
        fd.append("amount", hidden_amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.checkout_form_content').html(data.responseJSON.checkout_html);
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    jQuery('.remove_cart_item').click(function () {
                        var key_item = jQuery(this).attr('data-key');
                        remove_cart_item(key_item);
                    });
                    jQuery('.step1').addClass('hidden');
                    jQuery('.checkout_form').removeClass('hidden');
                    jQuery('.header-section').addClass('invisible');
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });

//    Yearly Ticket Handling
    jQuery('.yearly_ticket').click(function () {
        jQuery('.step1').addClass('hidden');
        jQuery('.cart-details').hide();
        jQuery('.yearly_ticket_details').removeClass('hidden');
    });
//    Day Ticket Vehicle Handling
    jQuery('.yearly_ticket_vehicle').click(function () {
        jQuery('.step1').addClass('hidden');
        jQuery('.cart-details').hide();
        jQuery('.yearly_ticket_details').addClass('hidden');
        jQuery('.yearly_ticket_vehicle_details').removeClass('hidden');
    });
    jQuery('.yearly_ticket_vehicle_details_form_submit').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.cart-details').hide();
        var vehicle_num = jQuery('.yearly_ticket_vehicle_details_form .vehicle_num').val();
        var amount = jQuery('.yearly_ticket_vehicle_details_form .amount').val();
        var amount_formated = jQuery('.yearly_ticket_vehicle_details_form .amount_formated').val();
        var booking_user_name = jQuery('.yearly_ticket_vehicle_details_form .booking_user_name').val();
        var booking_email = jQuery('.yearly_ticket_vehicle_details_form .booking_email').val();
        var product_id = jQuery('.yearly_ticket_vehicle_details_form .product_id').val();
        var product_name = jQuery('.yearly_ticket_vehicle_details_form .product_name').val();
        var error = 0;
        if (vehicle_num === '') {
            error = 1;
            jQuery('.yearly_ticket_vehicle_details_form .vehicle_num').addClass('required-missing');
        } else {
            jQuery('.yearly_ticket_vehicle_details_form .vehicle_num').removeClass('required-missing');
        }
        if (booking_email === '') {
            error = 1;
            jQuery('.day_ticket_vehicle_details_form .booking_email').addClass('required-missing');
        } else {
            jQuery('.day_ticket_vehicle_details_form .booking_email').removeClass('required-missing');
        }
        if (booking_user_name === '') {
            error = 1;
            jQuery('.day_ticket_vehicle_details_form .booking_user_name').addClass('required-missing');
        } else {
            jQuery('.day_ticket_vehicle_details_form .booking_user_name').removeClass('required-missing');
        }
        if (error === 1) {
            var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Alle velden gemarkeerd met (*) zijn verplicht.</div>';
            jQuery('.alert_message').html(error_html);
            jQuery('.overlay').addClass('hidden');
            return false;
        }
        jQuery('.yearly_ticket_vehicle_details_form_confirm .label_amount').html(amount_formated);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .label_booking_email').html(booking_email);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .label_booking_user_name').html(booking_user_name);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .label_vehicle').html(vehicle_num);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_booking_email').val(booking_email);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_booking_user_name').val(booking_user_name);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_amount').val(amount);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_vehicle').val(vehicle_num);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_product_id').val(product_id);
        jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_product_name').val(product_name);
        jQuery('.yearly_ticket_vehicle_details_form').addClass('hidden');
        jQuery('.yearly_ticket_vehicle_details_form_confirm').removeClass('hidden');
    });
    jQuery('.add_to_cart_yearly_ticket_vehicle').click(function () {
        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_amount').val();
        var hidden_vehicle = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_vehicle').val();
        var hidden_booking_email = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_booking_email').val();
        var hidden_booking_user_name = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_booking_user_name').val();
        var hidden_product_id = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_product_id').val();
        var hidden_product_name = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_product_name').val();

        var fd = new FormData();
        fd.append("type", 3);
        fd.append("product_id", hidden_product_id);
        fd.append("product_name", 'yearly_vehicle');
        fd.append("vehicle_num", hidden_vehicle);
        fd.append("booking_email", hidden_booking_email);
        fd.append("hidden_booking_user_name", hidden_booking_user_name);
        fd.append("amount", hidden_amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });
    jQuery('.yearly_ticket_vehicle_details_confirm').click(function () {
        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_amount').val();
        var hidden_vehicle = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_vehicle').val();
        var hidden_booking_email = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_booking_email').val();
        var hidden_booking_user_name = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_booking_user_name').val();
        var hidden_product_id = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_product_id').val();
        var hidden_product_name = jQuery('.yearly_ticket_vehicle_details_form_confirm .hidden_product_name').val();

        var fd = new FormData();
        fd.append("type", 3);
        fd.append("product_id", hidden_product_id);
        fd.append("product_name", 'yearly_vehicle');
        fd.append("vehicle_num", hidden_vehicle);
        fd.append("booking_email", hidden_booking_email);
        fd.append("hidden_booking_user_name", hidden_booking_user_name);
        fd.append("amount", hidden_amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.checkout_form_content').html(data.responseJSON.checkout_html);
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    jQuery('.remove_cart_item').click(function () {
                        var key_item = jQuery(this).attr('data-key');
                        remove_cart_item(key_item);
                    });
                    jQuery('.step1').addClass('hidden');
                    jQuery('.checkout_form').removeClass('hidden');
                    jQuery('.header-section').addClass('invisible');
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });

//    Yearly Ticket Person Handling
    jQuery('.yearly_ticket_person').click(function () {
        jQuery('.step1').addClass('hidden');
        jQuery('.cart-details').hide();
        jQuery('.yearly_ticket_details').addClass('hidden');
        jQuery('.yearly_ticket_person_details').removeClass('hidden');
    });
    jQuery('.yearly_ticket_person_details_form_submit').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.cart-details').hide();
        var amount_formated = jQuery('.yearly_ticket_person_details_form .amount_formated').val();
        var amount = jQuery('.yearly_ticket_person_details_form .amount').val();
        var booking_dob = jQuery('.yearly_ticket_person_details_form .booking_dob').val();
        var booking_email = jQuery('.yearly_ticket_person_details_form .booking_email').val();
        var booking_user_name = jQuery('.yearly_ticket_person_details_form .booking_user_name').val();
        var product_id = jQuery('.yearly_ticket_person_details_form .product_id').val();
        var product_name = jQuery('.yearly_ticket_person_details_form .product_name').val();
        var error = 0;
        if (booking_user_name === '') {
            error = 1;
            jQuery('.yearly_ticket_person_details_form .booking_user_name').addClass('required-missing');
        } else {
            jQuery('.yearly_ticket_person_details_form .booking_user_name').removeClass('required-missing');
        }
        if (booking_email === '') {
            error = 1;
            jQuery('.yearly_ticket_person_details_form .booking_email').addClass('required-missing');
        } else {
            jQuery('.yearly_ticket_person_details_form .booking_email').removeClass('required-missing');
        }
        if (booking_dob === '') {
            error = 1;
            jQuery('.yearly_ticket_person_details_form .booking_dob').addClass('required-missing');
        } else {
            jQuery('.yearly_ticket_person_details_form .booking_dob').removeClass('required-missing');
        }
        if (error === 1) {
            var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Alle velden gemarkeerd met (*) zijn verplicht.</div>';
            jQuery('.alert_message').html(error_html);
            jQuery('.overlay').addClass('hidden');
            return false;
        }
        jQuery('.yearly_ticket_person_details_form_confirm .label_amount').html(amount_formated);
        jQuery('.yearly_ticket_person_details_form_confirm .label_booking_email').html(booking_email);
        jQuery('.yearly_ticket_person_details_form_confirm .label_booking_user_name').html(booking_user_name);
        jQuery('.yearly_ticket_person_details_form_confirm .label_booking_dob').html(booking_dob);
        jQuery('.yearly_ticket_person_details_form_confirm .hidden_amount').val(amount);
        jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_dob').val(booking_dob);
        jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_email').val(booking_email);
        jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_user_name').val(booking_user_name);
        jQuery('.yearly_ticket_person_details_form_confirm .hidden_product_id').val(product_id);
        jQuery('.yearly_ticket_person_details_form_confirm .hidden_product_name').val(product_name);
        jQuery('.yearly_ticket_person_details_form').addClass('hidden');
        jQuery('.yearly_ticket_person_details_form_confirm').removeClass('hidden');
        jQuery('.overlay').addClass('hidden');
    });
    jQuery('.add_to_cart_yearly_ticket_person').click(function () {
        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.yearly_ticket_person_details_form_confirm .hidden_amount').val();
        var hidden_booking_dob = jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_dob').val();
        var hidden_booking_email = jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_email').val();
        var hidden_booking_user_name = jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_user_name').val();
        var hidden_product_id = jQuery('.yearly_ticket_person_details_form_confirm .hidden_product_id').val();
        var hidden_product_name = jQuery('.yearly_ticket_person_details_form_confirm .hidden_product_name').val();

        var fd = new FormData();
        fd.append("type", 3);
        fd.append("product_id", hidden_product_id);
        fd.append("product_name", 'yearly_person');
        fd.append("dob", hidden_booking_dob);
        fd.append("booking_email", hidden_booking_email);
        fd.append("hidden_booking_user_name", hidden_booking_user_name);
        fd.append("amount", hidden_amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });
    jQuery('.yearly_ticket_person_details_confirm').click(function () {
        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.yearly_ticket_person_details_form_confirm .hidden_amount').val();
        var hidden_booking_dob = jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_dob').val();
        var hidden_booking_email = jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_email').val();
        var hidden_booking_user_name = jQuery('.yearly_ticket_person_details_form_confirm .hidden_booking_user_name').val();
        var hidden_product_id = jQuery('.yearly_ticket_person_details_form_confirm .hidden_product_id').val();
        var hidden_product_name = jQuery('.yearly_ticket_person_details_form_confirm .hidden_product_name').val();

        var fd = new FormData();
        fd.append("type", 3);
        fd.append("product_id", hidden_product_id);
        fd.append("product_name", 'yearly_person');
        fd.append("dob", hidden_booking_dob);
        fd.append("booking_email", hidden_booking_email);
        fd.append("hidden_booking_user_name", hidden_booking_user_name);
        fd.append("amount", hidden_amount);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.checkout_form_content').html(data.responseJSON.checkout_html);
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    jQuery('.remove_cart_item').click(function () {
                        var key_item = jQuery(this).attr('data-key');
                        remove_cart_item(key_item);
                    });
                    jQuery('.step1').addClass('hidden');
                    jQuery('.checkout_form').removeClass('hidden');
                    jQuery('.header-section').addClass('invisible');
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });

    jQuery('.lang-nl-flag').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        var fd = new FormData();
        fd.append("lang", 'nl');
        fd.append('action', 'set_default_lang');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                window.location.href = ps_site_url;
                jQuery('.overlay').addClass('hidden');
            }
        });
    });
    jQuery('.lang-en-flag').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        var fd = new FormData();
        fd.append("lang", 'en');
        fd.append('action', 'set_default_lang');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                window.location.href = ps_site_url;
                jQuery('.overlay').addClass('hidden');
            }
        });
    });

    jQuery('.hourly_ticket').click(function () {
        jQuery('.step1').addClass('hidden');
        jQuery('.cart-details').hide();
        jQuery('.hourly_ticket_details').removeClass('hidden');
    });
    jQuery('.hourly_ticket_details_submit').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.cart-details').hide();
        var vehicle_num = jQuery('.hourly_ticket_details_form .vehicle_num').val();
        var error = 0;
        if (vehicle_num === '') {
            error = 1;
            jQuery('.hourly_ticket_details_form .vehicle_num').addClass('required-missing');
        } else {
            jQuery('.hourly_ticket_details_form .vehicle_num').removeClass('required-missing');
        }
        if (error === 1) {
            var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Alle velden gemarkeerd met (*) zijn verplicht.</div>';
            jQuery('.alert_message').html(error_html);
            jQuery('.overlay').addClass('hidden');
            return false;
        }
        var fd = new FormData();
        fd.append("vehicle_num", vehicle_num);
        fd.append('action', 'get_vehicle_price');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.hourly_ticket_details_form_confirm .label_amount').html('&euro;' + data.responseJSON.display_amount);
                    jQuery('.hourly_ticket_details_form_confirm .label_vehicle').html(vehicle_num);
                    jQuery('.hourly_ticket_details_form_confirm .hidden_amount').val(data.responseJSON.amount);
                    jQuery('.hourly_ticket_details_form_confirm .hidden_vehicle').val(vehicle_num);
                    jQuery('.hourly_ticket_details_form_confirm .hidden_booking_email').val('booking_email');
                    jQuery('.hourly_ticket_details_form_confirm .hidden_booking').val(data.responseJSON.booking);
                    jQuery('.hourly_ticket_details_form').addClass('hidden');
                    jQuery('.hourly_ticket_details_form_confirm').removeClass('hidden');
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + data.responseJSON.message + '</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }
        });
    });
    jQuery('.add_to_cart_hourly_ticket').click(function () {
        var hidden_amount = jQuery('.hourly_ticket_details_form_confirm .hidden_amount').val();
        var hidden_vehicle = jQuery('.hourly_ticket_details_form_confirm .hidden_vehicle').val();
        var hidden_booking = jQuery('.hourly_ticket_details_form_confirm .hidden_booking').val();
        var hidden_booking_email = jQuery('.hourly_ticket_details_form_confirm .hidden_booking_email').val();
        var fd = new FormData();
        fd.append("type", 2);
        fd.append("product_id", 0);
        fd.append("product_name", 'hourly_ticket');
        fd.append("vehicle_num", hidden_vehicle);
        fd.append("booking_email", hidden_booking_email);
        fd.append("amount", hidden_amount);
        fd.append("booking_id", hidden_booking);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }

        });
    });
    jQuery('.hourly_ticket_details_form_confirm_btn').click(function () {
        jQuery('.cart-details').hide();
        var hidden_amount = jQuery('.hourly_ticket_details_form_confirm .hidden_amount').val();
        var hidden_vehicle = jQuery('.hourly_ticket_details_form_confirm .hidden_vehicle').val();
        var hidden_booking = jQuery('.hourly_ticket_details_form_confirm .hidden_booking').val();
        var hidden_booking_email = jQuery('.hourly_ticket_details_form_confirm .hidden_booking_email').val();
        var fd = new FormData();
        fd.append("type", 2);
        fd.append("product_id", 0);
        fd.append("product_name", 'hourly_ticket');
        fd.append("vehicle_num", hidden_vehicle);
        fd.append("booking_email", hidden_booking_email);
        fd.append("amount", hidden_amount);
        fd.append("booking_id", hidden_booking);
        fd.append('action', 'add_item_to_cart');
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                if (data.responseJSON.status === 1) {
                    jQuery('.overlay').addClass('hidden');
                    jQuery('.checkout_form_content').html(data.responseJSON.checkout_html);
                    jQuery('.cart-details').html(data.responseJSON.cart_html);
                    jQuery('.items_count_con').html(data.responseJSON.cart_count);
                    reset_payment_form();
                    jQuery('.btn-checkout-popup').click(function () {
                        checkout_page();
                    });
                    jQuery('.remove_cart_item').click(function () {
                        var key_item = jQuery(this).attr('data-key');
                        remove_cart_item(key_item);
                    });
                    jQuery('.step1').addClass('hidden');
                    jQuery('.checkout_form').removeClass('hidden');
                    jQuery('.header-section').addClass('invisible');
                    return false;
                } else {
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>Something went wrong please try again.</div>';
                    jQuery('.alert_message').html(error_html);
                }
                jQuery('.overlay').addClass('hidden');
            }
        });
    });

    jQuery('.hourly_ticket_details_form .vehicle_num').keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == '13') {
            jQuery('.hourly_ticket_details_submit').click();
        }
    });

    jQuery('.pay_card').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');
        jQuery('.checkout_form').addClass('hidden');
        jQuery('.payment_form_card').removeClass('hidden');
        var stripe = Stripe(key);
        var elements = stripe.elements();
        var style = {
            base: {
                color: '#32325d',
                fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
                fontSmoothing: 'antialiased',
                fontSize: '16px',
                '::placeholder': {
                    color: '#aab7c4'
                }
            },
            invalid: {
                color: '#fa755a',
                iconColor: '#fa755a'
            }
        };
        var card = elements.create('card', {style: style});
        card.mount('#card-element');
        var newsletterSubscription = 0;
        if (jQuery('#newsletter_subscription').prop("checked") === true) {
            newsletterSubscription = 1;
        }
        var price = 0;
        var fd = new FormData();
        fd.append('action', 'get_total_cart_price');
        fd.append('newsletter_subscription', newsletterSubscription);
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                price = data.responseJSON.price;
                clientSecret = data.responseJSON.clientSecret;
            }
        });
        card.addEventListener('change', function (event) {
            if (event.error) {
                var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + event.error.message + '</div>';
                jQuery('.alert_message').html(error_html);
            } else {
                jQuery('.alert_message').html('');
            }
        });
        var form = document.getElementById('payment-form-card');
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            jQuery('.overlay').removeClass('hidden');
            jQuery('.alert_message').empty();
            jQuery(form).find('.color-blue').attr("disabled", "disabled").button('refresh');
            stripe.confirmCardPayment(clientSecret, {
                payment_method: {
                    card: card
                }
            }).then(function (paymentIntentResult) {
                if (paymentIntentResult.error) {
                    jQuery('.overlay').addClass('hidden');
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + paymentIntentResult.error.message + '</div>';
                    jQuery('.alert_message').html(error_html);
                    jQuery(form).find('.color-blue').removeAttr("disabled").button('refresh');
                } else {
                    if (paymentIntentResult.paymentIntent.status === 'succeeded') {
                        stripe_token_card(paymentIntentResult.paymentIntent);
                    }
                }
            });
        });
        jQuery('.overlay').addClass('hidden');
    });
    jQuery('.pay_ideal').click(function () {
        jQuery('.alert_message').html('');
        jQuery('.overlay').removeClass('hidden');

        jQuery('.checkout_form').addClass('hidden');
        jQuery('.payment_form_ideal').removeClass('hidden');
        var stripe = Stripe(key);
        var elements = stripe.elements();
        var options = {
            style: {
                base: {
                    fontSize: '16px',
                    color: '#32325d',
                    padding: '10px 12px',
                },
            }
        }

        var idealBank = elements.create('idealBank', options);

        idealBank.mount('#ideal-bank-element');
        var form = document.getElementById('payment-form-ideal');

        idealBank.on('change', function (event) {
            var bank = event.value;
        });
        var newsletterSubscription = 0;
        if (jQuery('#newsletter_subscription').prop("checked") === true) {
            newsletterSubscription = 1;
        }
        var price = 0;
        var fd = new FormData();
        fd.append('action', 'get_total_cart_price');
        fd.append('newsletter_subscription', newsletterSubscription);
        jQuery.ajax({
            type: 'POST',
            url: ajaxurl,
            data: fd,
            contentType: false,
            processData: false,
            dataType: 'json',
            complete: function (data) {
                price = data.responseJSON.price;
            }
        });
        form.addEventListener('submit', function (event) {
            event.preventDefault();

            var sourceData = {
                type: 'ideal',
                amount: parseInt(price * 100),
                currency: 'eur',
                owner: {
//                    email: hidden_email,
                },
                redirect: {
                    return_url: redirect_url
                },
            };

            stripe.createSource(idealBank, sourceData).then(function (result) {
                if (result.error) {
                    jQuery('.submit_btn_ideal').removeClass('clicked_element');
                    var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + result.error.message + '</div>';
                    jQuery('.alert_message').html(error_html);
                } else {
                    var fd = new FormData();
                    fd.append("source_id", result.source.id);
                    fd.append('action', 'set_booking_source');
                    jQuery.ajax({
                        type: 'POST',
                        url: ajaxurl,
                        data: fd,
                        contentType: false,
                        processData: false,
                        dataType: 'json',
                        complete: function (data) {
                            jQuery('.submit_btn_ideal').removeClass('clicked_element');
                            if (data.responseJSON.status === 1) {
                                stripeSourceHandler(result.source);
                            } else {
                                var error_html = '<div class="alert alert-danger alert-dismissible"><a href="#" class="close" data-dismiss="alert" aria-label="close">x</a>' + data.responseJSON.message + '</div>';
                                jQuery('.alert_message').html(error_html);
                            }
                        }
                    });

                }
            });
        });
        jQuery('.overlay').addClass('hidden');
    });

});
function stripeSourceHandler(source) {
    document.location.href = source.redirect.url;
}
function stripe_token_card(token) {
    // Insert the token ID into the form so it gets submitted to the server
    var form = document.getElementById('payment-form-card');
    var appendUrl = '/charge-card?token=' + token.id;
    jQuery(form).attr('action', appendUrl);
    // Submit the form
    form.submit();
}

jQuery(document).ready(function () {
    get_tickets_availability();
});

function get_tickets_availability() {
    var fd = new FormData();
    fd.append('action', 'get_tickets_availability');
    jQuery.ajax({
        type: 'POST',
        url: ajaxurl,
        data: fd,
        contentType: false,
        processData: false,
        dataType: 'json',
        complete: function (data) {
            console.log(data.responseJSON);
            if (data.responseJSON.status === "1") {
                info = data.responseJSON.data;
                jQuery('#total_person_available').val(info.person_tickets_left);
                jQuery('#total_parking_available').val(info.parking_tickets_left);
//                if (info.person_tickets_left <= 0) {
//                    if (!jQuery(".day_ticket_person").hasClass('sold-out')) {
//                        jQuery(".day_ticket_person").addClass('sold-out');
//                    }
//                } else {
//                    if (jQuery(".day_ticket_person").hasClass('sold-out')) {
//                        jQuery(".day_ticket_person").removeClass('sold-out');
//                    }
//                }
//                if (info.parking_tickets_left <= 0) {
//                    if (!jQuery(".day_ticket_vehicle").hasClass('sold-out')) {
//                        jQuery(".day_ticket_vehicle").addClass('sold-out');
//                    }
//                }
//                else {
//                    if (jQuery(".day_ticket_vehicle").hasClass('sold-out')) {
//                        jQuery(".day_ticket_vehicle").removeClass('sold-out');
//                    }
//                }
            } else {

            }
            //setTimeout(get_tickets_availability, 600000);
        }
    });
}
